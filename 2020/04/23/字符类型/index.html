<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
	<!-- title -->
	
	<title>
	
		字符类型 | 
	 
	Been&#39;s Blog
	</title>
	
	<!-- keywords,description -->
	 
		<meta name="description" content="my markdown blog" />
	

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/favicon.ico">
	
  

	
<link rel="stylesheet" href="/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">


	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/js/main.js"></script>

	
		
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

		
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

	
	
		<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
<meta name="generator" content="Hexo 4.2.0"></head>

<body>
	<header id="header">
    <a id="title" href="/" class="logo">Been's Blog</a>

	<ul id="menu">
		<li class="menu-item">
			<a href="/about" class="menu-item-link">ABOUT</a>
		</li>
		
		<li class="menu-item">
			<a href="https://github.com/wujun234/uid-generator-spring-boot-starter" class="menu-item-link" target="_blank">
				UidGenerator
			</a>
		</li>
		<li class="menu-item">
			<a href="https://github.com/BeenStone01" class="menu-item-link" target="_blank">
				<i class="fa fa-github fa-2x"></i>
			</a>
		</li>
	</ul>
</header>

	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="text" placeholder="search...">
		<div id="tree">
			

			
							<ul>
								<li class="file">
									<a href="/2020/04/23/C++%E4%BB%A3%E7%A0%81%E6%A0%B7%E4%BE%8B/">
										C++代码样例
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/19/GPIB/">
										GPIB
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/Laravel/">
										Laravel
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/24/Linux%E5%9C%A8%E7%BA%BF/">
										Linux在线
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/29/MFC/">
										MFC
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/29/MFC%E5%A4%9A%E7%BA%BF%E7%A8%8B/">
										MFC多线程
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/MFC%E8%87%AA%E7%BB%98%E6%8C%89%E9%92%AE/">
										MFC自绘按钮
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/MFC%E8%87%AA%E7%BB%98%E6%A6%82%E8%BF%B0/">
										MFC自绘概述
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/SSDP%E5%BC%80%E5%8F%91%E8%AF%B4%E6%98%8E/">
										SSDP开发说明
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/STL_vector/">
										STL_vector
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/STL/">
										STL
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/WinHttp%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/">
										WinHttp使用详解
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/WinInet%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/">
										WinInet使用详解
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/Wininte%E6%A0%B7%E4%BE%8B%E8%A7%A3%E6%9E%90/">
										Wininte样例解析
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/26/XML%E4%B9%8BIXMLHTTPReuest/">
										XML之IXMLHTTPReuest
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/XML%E6%93%8D%E4%BD%9C%E4%B9%8BCMarkUp/">
										XML操作之CMarkUp
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/XML%E8%A7%A3%E6%9E%90/">
										XML解析
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/c++11/">
										c++11
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/06/c++%E5%B0%8F%E7%A8%8B%E5%BA%8F/">
										c++小程序
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/26/c-%E6%9C%AA%E5%BD%92%E7%B1%BB%E4%BB%A3%E7%A0%81/">
										c-未归类代码
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/hexo/">
										hexo
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/socket/">
										socket
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/24/thread-2/">
										thread-2
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/thread/">
										thread
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/vue%E7%AC%94%E8%AE%B0/">
										vue笔记
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/webpack%E4%BD%BF%E7%94%A8/">
										webpack使用
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/30/%E4%B8%B2%E5%8F%A3com%E7%BC%96%E7%A8%8B/">
										串口com编程
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/05/03/%E5%88%B7%E9%A2%98%E7%BA%AA%E5%BD%95/">
										刷题纪录
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file active">
									<a href="/2020/04/23/%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B/">
										字符类型
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/">
										小程序开发笔记
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/24/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E5%91%BD%E4%BB%A4/">
										常用工具命令
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99/">
										文件读写
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/04/23/%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2/">
										编码格式转换
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content">
		<h1 id="article-title">

	字符类型
</h1>
<div class="article-meta">
	
	<span>Been Stone</span>
	<span>2020-04-23 17:08:18</span>
    
		<div id="article-categories">
            
		</div>
    
</div>

<div id="article-content">
	<h1 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h1><h2 id="1-基本数据类型"><a href="#1-基本数据类型" class="headerlink" title="1. 基本数据类型"></a>1. 基本数据类型</h2><p>一个字符可以用1byte表示（ANSI编码)，也可以用2byte表示（Unicode编码）。vc++支持char和wchar_t作为ANSI和Unicode的原始数据类型</p>
<pre><code class="cpp">char cRes;
char cStr[64];
//宽字符
wchar_t wcRes;
wchar_t wcStr[64];</code></pre>
<h3 id="1-1-TCHAR-可变字符类型"><a href="#1-1-TCHAR-可变字符类型" class="headerlink" title="1.1 TCHAR 可变字符类型"></a>1.1 TCHAR 可变字符类型</h3><pre><code class="cpp">#ifdef _UNICODE
typedef wchar_t TCHAR;
#else
typedef char TCHAR;
#endif

#include &lt;tchar.h&gt;
TCHAR tcRes;
TCHAR tcStr[64];</code></pre>
<p>“this is a string”  表示一个ANSI-string<br>L”this is a string” 表示一个Unicode-string<br>_T(“this is a string”)  自适应</p>
<blockquote>
<ul>
<li>WCHAR - wchar_t</li>
<li>TCHAR - char/wchar_t</li>
<li>LPSTR - char*</li>
<li>LPCSTR - const char*</li>
<li>LPWSTR - wchar_t* </li>
<li>LPCWSTR - const wchar_t*</li>
<li>LPTSTR - TCHAR*</li>
<li>LPCTSTR - const TCHAR*</li>
</ul>
</blockquote>
<p>写代码建议使用Unicode版本，因为实际运行的总是Unicode。</p>
<p>注意事项：<br>通过new直接指定字符个数，不用去管具体分配了多少字节；<br>而 malloc, LocalAlloc, GlobalAlloc这类api分配空间，就需要考虑字节数</p>
<pre><code class="cpp">#include &lt;iostream&gt;
#include &lt;tchar.h&gt;
#include &lt;locale.h&gt;

using namespace std;

int _tmain(int argc, _TCHAR* argv[])
{
    //setlocale(LC_ALL, &quot;chs&quot;);
    wcout.imbue(locale(&quot;chs&quot;));
    //wcout.imbue(locale(&quot;us&quot;));
    //想要输出宽字符，加上这句就可以了
    //wcout.imbue(locale(&quot;&quot;, LC_CTYPE));

    wchar_t w = L&#39;我&#39;;
    wcout &lt;&lt; w &lt;&lt; endl;
    system(&quot;pause&quot;);
    return 0;
}
pBuffer = TCHAR* malloc(128*sizeof(THCAR));    </code></pre>
<h1 id="常用处理函数"><a href="#常用处理函数" class="headerlink" title="常用处理函数"></a>常用处理函数</h1><h2 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h2><p>size_t strcpy_s(), strlen(), strcat()<br>size_t wcscpy(), wcslen(), wcscat()<br>size_t _tcscpy(), _tcslen(), _tcscat()</p>
<p>size_t strlen(const char<em>);  等价于 size_t strlen(lPCSTR);<br>typedef const char</em> LPCSTR;<br>size wcslen(const wchar_t* szString); 等价于 size_t wcslen(LPCWSTR szString);<br>typedef const WCHAR* LPCWSTR;</p>
<h3 id="1-2-LPCSTR-→-LPCWSTR"><a href="#1-2-LPCSTR-→-LPCWSTR" class="headerlink" title="1.2 LPCSTR → LPCWSTR"></a>1.2 LPCSTR → LPCWSTR</h3><p>LPCWSTR 是Unicode字符串，需要MultiByteToWideChar()转换<br>普通字符串+L来表示宽字符</p>
<pre><code class="cpp">char chArray[] = &quot;this is a test&quot;;
char* ptr = &quot;this is a test&quot;;

LPSTR p = &quot;this is a test&quot;;

TCHAR* pChar = _T(&quot;this is a test&quot;);</code></pre>
<h2 id="2-char-→-CString"><a href="#2-char-→-CString" class="headerlink" title="2. char* → CString"></a>2. char* → CString</h2><pre><code class="cpp">CString szStr = chArray;

szStr.Format(_T(&quot;%s&quot;), chArray);</code></pre>
<h2 id="3-CString-→-char"><a href="#3-CString-→-char" class="headerlink" title="3. CString → char*"></a>3. CString → char*</h2><h3 id="nbsp-1-宏"><a href="#nbsp-1-宏" class="headerlink" title="&nbsp;  1). 宏"></a>&nbsp;  1). 宏</h3><pre><code class="cpp">CString szStr;
USES_CONVERSION;
char* pCh = T2A(szStr);</code></pre>
<h3 id="nbsp-2-强制转换"><a href="#nbsp-2-强制转换" class="headerlink" title="&nbsp;  2). 强制转换"></a>&nbsp;  2). 强制转换</h3><pre><code class="cpp">LPTSTR lpszStr = (LPTSTR)(LPCTSTR)szStr;</code></pre>
<h3 id="nbsp-3-使用strcpy-s"><a href="#nbsp-3-使用strcpy-s" class="headerlink" title="&nbsp;  3). 使用strcpy_s()"></a>&nbsp;  3). 使用strcpy_s()</h3><pre><code class="cpp">LPTSTR lpszStr = new TCHAR[szStr.GetLength()+1];
_tcscpy(lpszStr, szStr);</code></pre>
<p>strcoy(或可移值Unicode/MBCS的——tcscpy)的第二个参数是const wchar_t* (Unicode)或const char* (ANSI), 系统编译器将自动对其进行转换   </p>
<h3 id="nbsp-4-使用CString-GetBuffer"><a href="#nbsp-4-使用CString-GetBuffer" class="headerlink" title="&nbsp;  4). 使用CString::GetBuffer()"></a>&nbsp;  4). 使用CString::GetBuffer()</h3><pre><code class="cpp">LPTSTR lpszStr = szStr.GetBuffer();
……
if(lpszStr != NULL)
    *lpszStr = _T(&#39;/0&#39;);
szStr.ReleaseBuffer();      //使用完及时释放</code></pre>
<h2 id="4-String-→-const-char"><a href="#4-String-→-const-char" class="headerlink" title="4. String → const char*"></a>4. String → const char*</h2><pre><code class="cpp">string str = &quot;abc&quot;;
const char* pch = str.c_str();</code></pre>
<h2 id="5-string-→-CString"><a href="#5-string-→-CString" class="headerlink" title="5. string → CString"></a>5. string → CString</h2><pre><code class="cpp">string str = &quot;abc&quot;;
CString szStr = CString(str.c_str());</code></pre>
<hr>
<h2 id="ANSI、Unicode和宽字符之间的转换"><a href="#ANSI、Unicode和宽字符之间的转换" class="headerlink" title="ANSI、Unicode和宽字符之间的转换"></a>ANSI、Unicode和宽字符之间的转换</h2><p>　　方法一，使用MultiByteToWideChar将ANSI字符转换成Unicode字符，使用WideCharToMultiByte将Unicode字符转换成ANSI字符。</p>
<p>　　方法二，使用“_T”将ANSI转换成“一般”类型字符串，使用“L”将ANSI转换成Unicode，而在托管C++环境中还可使用S将ANSI字符串转换成String*对象。例如：</p>
<pre><code class="cpp">TCHAR tstr[] = _T(&quot;this is a test&quot;);
wchar_t wszStr[] = L&quot;This is a test&quot;;
string* str = S&quot;This is a test&quot;; </code></pre>
<p>使用ATL 7.0的转换宏和类。ATL7.0在原有3.0基础上完善和增加了许多字符串转换宏以及提供相应的类，它具有如图3所示的统一形式：</p>
<p>　　其中，第一个C表示“类”，以便于ATL 3.0宏相区别，第二个C表示常量，2表示“to”，EX表示要开辟一定大小的缓冲。SourceType和DestinationType可以是A、 T、W和OLE，其含义分别是ANSI、Unicode、“一般”类型和OLE字符串。例如，CA2CT就是将ANSI转换成一般类型的字符串常量。下面是一些示例代码：</p>
<pre><code class="cpp">LPTSTR tstr = CA2TEX&lt;16&gt;(&quot;this is a test&quot;);
LPCTSTR tcstr = CA2CT(&quot;this is a test&quot;);
wchar_t wszStr[] = L&quot;This is a test&quot;;
char* chStr = CW2A(wszStr);</code></pre>
<hr>
<h3 id="CString-Unicode-→-string-UTF8"><a href="#CString-Unicode-→-string-UTF8" class="headerlink" title="CString(Unicode) → string(UTF8)"></a>CString(Unicode) → string(UTF8)</h3><pre><code class="cpp">string _UnicodeToUtf8(CString Unicodestr)
{
    wchar_t* unicode = Unicodestr.AllocSysString();
    int len;
    len = WideCharToMultiByte(CP_UTF8, 0, unicode, -1, NULL, 0, NULL, NULL);
    char *szUtf8 = (char*)malloc(len + 1);
    memset(szUtf8, 0, len + 1);
    WideCharToMultiByte(CP_UTF8, 0, unicode, -1, szUtf8, len, NULL, NULL);
    string result = szUtf8;
    free(szUtf8);
    return result;
}</code></pre>
<h3 id="CString-→-string-UTF8"><a href="#CString-→-string-UTF8" class="headerlink" title="CString → string(UTF8)"></a>CString → string(UTF8)</h3><pre><code class="cpp">static std::string ConvertCStringToUTF8( CString strValue )
{
    std::wstring wbuffer;
#ifdef _UNICODE
    wbuffer.assign( strValue.GetString(), strValue.GetLength() );
#else
    /*
     * 转换ANSI到UNICODE
     * 获取转换后长度
     */
    int length = ::MultiByteToWideChar( CP_ACP, MB_ERR_INVALID_CHARS, (LPCTSTR) strValue, -1, NULL, 0 );
    wbuffer.resize( length );
    /* 转换 */
    MultiByteToWideChar( CP_ACP, 0, (LPCTSTR) strValue, -1, (LPWSTR) (wbuffer.data() ), wbuffer.length() );
#endif

    /* 获取转换后长度 */
    int length = WideCharToMultiByte( CP_UTF8, 0, wbuffer.data(), wbuffer.size(), NULL, 0, NULL, NULL );
    /* 获取转换后内容 */
    std::string buffer;
    buffer.resize( length );

    WideCharToMultiByte( CP_UTF8, 0, strValue, -1, (LPSTR) (buffer.data() ), length, NULL, NULL );
    return(buffer);
}</code></pre>
<h3 id="char-utf8-→-CString"><a href="#char-utf8-→-CString" class="headerlink" title="char* utf8 → CString"></a>char* utf8 → CString</h3><pre><code class="cpp">GetStringWFromUtf8(const char* str, int strLen)
{
    int len = MultiByteToWideChar(CP_UTF8, 0, str, strLen, 0, 0);
    CStringW buf;
    WCHAR* dd = buf.GetBuffer(len);
    len = MultiByteToWideChar(CP_UTF8, 0, str, strLen, dd, len);
    buf.ReleaseBuffer(len);
    return buf;
}</code></pre>
<h3 id="string-UTF8-→-CString"><a href="#string-UTF8-→-CString" class="headerlink" title="string(UTF8) → CString"></a>string(UTF8) → CString</h3><pre><code class="cpp">static CString ConvertUTF8ToCString( std::string utf8str )
{
    /* 预转换，得到所需空间的大小 */
    int nLen = ::MultiByteToWideChar( CP_UTF8, NULL,
                      utf8str.data(), utf8str.size(), NULL, 0 );
    /* 转换为Unicode */
    std::wstring wbuffer;
    wbuffer.resize( nLen );
    ::MultiByteToWideChar( CP_UTF8, NULL, utf8str.data(), utf8str.size(),
                   (LPWSTR) (wbuffer.data() ), wbuffer.length() );

#ifdef UNICODE
    return(CString( wbuffer.data(), wbuffer.length() ) );
#else
    /*
     * 转换为ANSI
     * 得到转换后长度
     */
    nLen = WideCharToMultiByte( CP_ACP, 0,
                    wbuffer.data(), wbuffer.length(), NULL, 0, NULL, NULL );

    std::string ansistr;
    ansistr.resize( nLen );

    /* 把unicode转成ansi */
    WideCharToMultiByte( CP_ACP, 0, (LPWSTR) (wbuffer.data() ), wbuffer.length(),
                 (LPSTR) (ansistr.data() ), ansistr.size(), NULL, NULL );
    return(CString( ansistr.data(), ansistr.length() ) );
#endif
}</code></pre>
<hr>
<h3 id="UTF8-→-Unicode-char-wchar-t"><a href="#UTF8-→-Unicode-char-wchar-t" class="headerlink" title="UTF8 → Unicode (char* wchar_t*)"></a>UTF8 → Unicode (char* wchar_t*)</h3><pre><code class="cpp">wchar_t * UTF8ToUnicode( const char* str )

{
     int textlen ;
     wchar_t * result;

     textlen = MultiByteToWideChar( CP_UTF8, 0, str,-1, NULL,0 );

     result = (wchar_t *)malloc((textlen+1)*sizeof(wchar_t));

     memset(result,0,(textlen+1)*sizeof(wchar_t));

     MultiByteToWideChar(CP_UTF8, 0,str,-1,(LPWSTR)result,textlen );

     return result;
}</code></pre>
<h3 id="Unicode-→-UTF8-wchar-t-char"><a href="#Unicode-→-UTF8-wchar-t-char" class="headerlink" title="Unicode → UTF8 (wchar_t* char*)"></a>Unicode → UTF8 (wchar_t* char*)</h3><pre><code class="cpp">char * UnicodeToUTF8( const wchar_t* str )

{
     char* result;
     int textlen;

     textlen = WideCharToMultiByte( CP_UTF8, 0, str, -1, NULL, 0, NULL, NULL );

     result =(char *)malloc((textlen+1)*sizeof(char));

     memset(result, 0, sizeof(char) * ( textlen + 1 ) );

     WideCharToMultiByte( CP_UTF8, 0, str, -1, result, textlen, NULL, NULL );

     return result;
}</code></pre>
<h3 id="ANSI-→-Unicode-char-wchar-t"><a href="#ANSI-→-Unicode-char-wchar-t" class="headerlink" title="ANSI → Unicode (char* wchar_t*)"></a>ANSI → Unicode (char* wchar_t*)</h3><pre><code class="cpp">wchar_t * ANSIToUnicode( const char* str )
{
     int textlen ;
     wchar_t * result;

     textlen = MultiByteToWideChar( CP_ACP, 0, str,-1, NULL,0 );

     result = (wchar_t *)malloc((textlen+1)*sizeof(wchar_t));

     memset(result,0,(textlen+1)*sizeof(wchar_t));

     MultiByteToWideChar(CP_ACP, 0,str,-1,(LPWSTR)result,textlen );

     return result;
}</code></pre>
<h3 id="Unicode-→-ANSI-wchar-t-char"><a href="#Unicode-→-ANSI-wchar-t-char" class="headerlink" title="Unicode → ANSI (wchar_t* char*)"></a>Unicode → ANSI (wchar_t* char*)</h3><pre><code class="cpp">char * UnicodeToANSI( const wchar_t* str )
{
     char* result;
     int textlen;

     textlen = WideCharToMultiByte( CP_ACP, 0, str, -1, NULL, 0, NULL, NULL );

     result =(char *)malloc((textlen+1)*sizeof(char));

     memset( result, 0, sizeof(char) * ( textlen + 1 ) );

     WideCharToMultiByte( CP_ACP, 0, str, -1, result, textlen, NULL, NULL );

     return result;
}</code></pre>
<h3 id="宽字符-→-多字符-wchar-t-char"><a href="#宽字符-→-多字符-wchar-t-char" class="headerlink" title="宽字符 → 多字符 (wchar_t* char*)"></a>宽字符 → 多字符 (wchar_t* char*)</h3><pre><code class="cpp">char* w2m(const wchar_t* wcs)
{
      int len;
      char* buf;

      len =wcstombs(NULL,wcs,0);

      if (len == 0)

          return NULL;

      buf = (char *)malloc(sizeof(char)*(len+1));

      memset(buf, 0, sizeof(char) *(len+1));

      len =wcstombs(buf,wcs,len+1);

      return buf;
}</code></pre>
<h3 id="多字符-→-宽字符-char-wchar-t"><a href="#多字符-→-宽字符-char-wchar-t" class="headerlink" title="多字符 → 宽字符 (char* wchar_t*)"></a>多字符 → 宽字符 (char* wchar_t*)</h3><pre><code class="cpp">wchar_t* m2w(const char* mbs)
{
      int len;
      wchar_t* buf;

      len =mbstowcs(NULL,mbs,0);

      if (len == 0)

          return NULL;

      buf = (wchar_t *)malloc(sizeof(wchar_t)*(len+1));

      memset(buf, 0, sizeof(wchar_t) *(len+1));

      len =mbstowcs(buf,mbs,len+1);

      return buf;
}</code></pre>
<h3 id="ANSI-UTF8-char-char"><a href="#ANSI-UTF8-char-char" class="headerlink" title="ANSI UTF8 (char* char*)"></a>ANSI UTF8 (char* char*)</h3><pre><code class="cpp">char* ANSIToUTF8(const char* str)

{
     return UnicodeToUTF8(ANSIToUnicode(str));
}



char* UTF8ToANSI(const char* str)

{
     return UnicodeToANSI(UTF8ToUnicode(str));
}</code></pre>

</div>


    <div class="post-guide">
        <div class="item left">
            
              <a href="/2020/04/23/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  文件读写
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/2020/04/23/%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2/">
                编码格式转换
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>



	<div id="vcomments"></div>


<script>
	
		// 评论
		new Valine({
			av: AV,
			el: '#vcomments',
			notify: false,
			verify: false,
			path: window.location.pathname,
			appId: '',
			appKey: '',
			placeholder: '请输入评论',
			avatar: 'retro',
			recordIP: false
		})
	
	
</script>
	</div>
	<div id="footer">
	<p>
	©2019-<span id="footerYear"></span> 
	<a href="/">Been Stone</a> 
	
	
		|
		<span id="busuanzi_container_site_pv">
			pv
			<span id="busuanzi_value_site_pv"></span>
		</span>
		|
		<span id="busuanzi_container_site_uv"> 
			uv
			<span id="busuanzi_value_site_uv"></span>
		</span>
	
	<br>
	Theme <a href="//github.com/wujun234/hexo-theme-tree" target="_blank">Tree</a>
	by <a href="//github.com/wujun234" target="_blank">WuJun</a>
	Powered by <a href="//hexo.io" target="_blank">Hexo</a>
	</p>
</div>
<script type="text/javascript"> 
	document.getElementById('footerYear').innerHTML = new Date().getFullYear() + '';
</script>
	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>